# 数学题库

### 软件介绍

本软件是为管理数学题目而设计，目的是解决数学题目录入困难和自由组织导出题目等问题。希望避免每学期都要花大量时间出练习题给学生，以及学生拿往年作业答案偷懒。

共设置六类题目类型，每道题目可以设置题干、解答、所属章节（以同济七版高等数学为参考）、难度和题目来源。各题型特征如下：

- 单选题：题干只能有一个待填空位；答案支持最多4个选项，至少需要填写A、B两项
- 多选题：题干可以有 1-4 个待填空位；答案支持最多4个选项，至少需要填写A、B两项；每个空位支持指定多个答案
- 判断题：可设定题干正确或错误
- 填空题：题干可以有 1-4 个待填空位；每个空位对应一个答案
- 计算题：只能录入题干和解答
- 证明题：只能录入题干和解答

本软件主要功能如下：
- 新建、更换题库
- 浏览题库中的题目，可按章节和题目类型筛选
- 添加、修改、复制、删除题目
- 导出题目
  - 按章节导出，可选择多个章节，将提示各章节各类型题目数量
  - 自由选题导出（逐道勾选题目），将提示当前所选择的题目总数
  - 读取题目的 id，每次导出题目时将同时导出题目 id
- 导出选项包括
  - 指定各类型题目数量
  - 包含解答（解答在所有题目后面）
  - 解答跟随题干
  - 主观题后留空 (同时选中“主观题后留空”和“解答跟随小题”时，在 tex 文件中可以通过更改 `\usetag` 来选择显示解答还是显示空白还是同时显示，在HTML文件中将同时显示)
  - 打乱题目顺序
  - 打乱选择题选项顺序（因为有此选项存在，所以录入选择题解析时最好不要出现ABCD字样）
  - 填写导出文档的标题
  - 按难度筛选

本程序已在 Windows 10 和 MacOS 上测试可用。

### 题目录入说明
1. 在添加题目的过程中支持预览，预览以 `MathJax` 渲染公式，支持大部分 $\LaTeX$ 数学公式命令。如果对 $\LaTeX$ 不熟悉可以使用网站 [https://www.latexlive.com/](https://www.latexlive.com/) 来建构公式并获取 $\LaTeX$ 代码。
2. `MathJax` 在默认的基础上加载了 `physics` 包以支持微分符号。具体支持的命令可以参见[这里](https://docs.mathjax.org/en/latest/input/tex/macros/index.HTML)。该页面上第二列为空或 `base`, `physics` 的命令都可以使用。
3. 另外还添加了以下较常用的宏：

| 宏 |  HTML 中显示为 |
| ----- | -------- |
| \Prj | $\text{Prj}$ |
| \oiint | $\unicode{x222F}$ |
| \oiiint | $\unicode{x2230}$ |
3. 在单选题和多选题中用 `\emptychoice` 表示（　）
4. 在填空题中用 `\blank` 表示待填空位______，可以用 `\blank{d}`指定空位宽度为 d 个汉字宽度，d 默认为 3
5. 支持用 `\subq` 表示子问题，子问题导出时用小括号数字编号 (如：(1) )，如果子问题后仍有题目主干文字，则需用两个回车表示子问题输入结束，再输入题目主干，当前每个可填写位置仅支持输入一组子问题
6. 在设计上，数据库中存储的实际上是 $\LaTeX$ 源码，所以录入时可以使用 $\LaTeX$ 语句，虽然可能不能预览，但导出为 $\LaTeX$ 格式文档后可以编译。

### 导出格式说明
可导出的文档格式有两种
1. $\LaTeX$ 源码( .tex )，用 `xelatex` 编译即可生成题目文档。因此需要安装 $\TeX$ 发行版，或在 [overleaf](https://cn.overleaf.com/) 等在线 $\LaTeX$ 平台上编译。
2. HTML文件( .HTML )，用浏览器打开即可，可打印成 pdf 文档。请注意该文档需联网才能正确显示公式，且该文档中对于 MathJax 不支持的 $\LaTeX$ 环境或命令，将显示为警告信息。但对于以下环境作了特别处理；
   1.  `minipage` 环境：显示其中内容，但忽略宽度设置
   2.  `tabular` 环境：转化为同行数同列数的表格，文字居中，忽略设置，其中识别列数时仅识别 $\LaTeX$ 默认列类型 `c`、`l`、`r`、`p`
   3.  `tikzpicture` 环境，不显示

### 计划功能
- 添加、修改、删除难度
- 开发在线版？

### 已知问题
- 一次输入中不能出现多个子问题列表，即不能出现多个双回车

### Required Python packages
- webbrowser, requests, os, regex, random, datetime
- PyQt5, PyQtWebEngine

### 使用方法

运行 questions.py

### 更新记录
ver. 2020.10.22
- 修复 Bug: 存储数据时未将换行转换为 $\LaTeX$ 格式

ver. 2020.10.14
- 修复 Bug: 添加和修改单选题失败

ver. 2020.10.13
- 修复 Bug: 添加题目时未能自动填写上一次添加的题目难度和题目来源

ver. 2020.09.28
- 在预览和导出 HTML 时显示 `minipage` 环境里的内容，但不保留其宽度设置
- 在预览和导出 HTML 时显示 `tabular` 环境里的内容，仅识别行数列数，重新生成文字居中的 HTML 表格。其中识别列数时仅识别 $\LaTeX$ 默认列类型 `c`、`l`、`r`、`p`
- 在预览时显示 `tikzpicture` 环境警告，在导出 HTML 时删除 `tikzpicture` 环境警告
- 没有操作人时新建题库则自动添加操作人“无名氏”

ver. 2020.09.26
- 取消选中“包含解答”时，自动取消选中“解答跟随题干”

ver. 2020.09.25
- 新建题库功能
- 更换题库功能
- 增加操作人选项
- 启动软件自动检测更新

ver. 2020.09.24
- 增加、修改、删除章节

ver. 2020.09.23
- 增加、修改、删除题目来源

ver. 2020.04.14
- 添加文本框用以输入导出习题集的标题
- 导入题目 id 时支持读取选择题选项顺序，在自由选题时如果删去题目则将丢失选项顺序，新选中的题目采取默认选项顺序
- 子问题命令变更为 `\subq`，以双回车表示所有字问题软件结束

ver. 2020.04.06
- 支持导出HTML
- 支持自由选择题目导出
- 从按章节导出保留题目切换至自由选题导出
- 按章节导出时可指定各类型题目数量，系统将随机抽取指定数量的题目，抽取原则基本遵循题目数量较多的章节中抽取的概率较大。
- 导出时可使选择题选项随机排序（导入题目 id 功能暂不能导入选择题选项顺序）
- 同时选中“主观题后留空”和“解答跟随小题”时，在 `tex` 文件中可以通过更改 `\usetag` 来选择显示解答还是显示空白还是同时显示，在 HTML 文件中将同时显示

ver. 2020.03.19
- 保存、读取导出题目 id

ver. 2020.03.16
- 增加按难度筛选题目
- 可以在主观题后加入空白
- 可选题目乱序
  
ver. 2020.03.15
- 增加导出解答紧跟题目选项，选中后每一小题的解答将出现在该题目之后；不选中时所有解答统一出现在文档最后
- 修复若干字符转换 bug

ver. 2020.03.12
- 输入所有题干、计算题证明题解答、以及其余题型解析时，支持用`\sub`表示子问题

ver. 2020.03.11
- 增加删除题目功能
- 增加复制题目功能
- 在导出题目标签页上，选择章节的控件更换为树状
- 界面微调
  
ver. 2020.03.10
- 增加修改题目功能
  
ver. 2020.03.07
- 修改界面为3个标签页：题库概览，录入与修改题目，导出题目
- 在题库概览标签页上可以浏览选中章节中的题目，并按题目类型筛选
- 导出选择题时自动判断选项以1、2或4列显示
- 添加题目窗口上设置了快捷键

ver. 2020.03.06
- 第一版
